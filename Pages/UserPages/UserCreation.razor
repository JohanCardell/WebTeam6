@using WebTeam6.Data;
@using WebTeam6.Services
@inject IUserService service;
@inject IJSRuntime jsRuntime

<div class="modal fade" tabindex="-1" role="dialog" id="userModal">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">User details</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">×</span>
                </button>
            </div>
            <div class="modal-body">
                <EditForm id="user-creation-form" Model="@UserObject" OnValidSubmit="@HandleValidSubmit">
                    <DataAnnotationsValidator />
                    <ValidationSummary />
                    <div class="form-group">
                        <label for="username">Username</label>
                        <input type="hidden" @bind-value="@UserObject.Id" />
                        <InputText id="new-username-field" type="text" class="form-control" @bind-Value="@UserObject.UserName" />
                    </div>
                    <div class="form-group">
                        <label for="email">Email address</label>
                        <input type="hidden" @bind-value="@UserObject.Email" />
                        <InputText id="new-email-field" type="email" class="form-control" @bind-Value="@UserObject.Email" />
                    </div>
                    <div class="form-group">
                        <label for="password">Password</label>
                        <input type="hidden" @bind-value="@UserObject.PasswordHash" />
                        <InputText id="new-password-field" type="password" class="form-control" @bind-Value="@UserObject.PasswordHash" />
                    </div>

                    <button id="submit-btn" type="submit" class="btn btn-primary">Submit</button>
                    <button id="cancel-btn" type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                </EditForm>
            </div>
        </div>
    </div>
</div>

@code {
    [Parameter]
    public User UserObject { get; set; }

    [Parameter]
    public Action DataChanged { get; set; }

    private async Task CloseUserModal()
    {
        await jsRuntime.InvokeAsync<object>("CloseModal", "userModal");
    }

    private async void HandleValidSubmit()
    {
        await service.Add(UserObject);
        await CloseUserModal();
        DataChanged?.Invoke();
    }
}

@*<EditForm id="registrationForm" Model="_userObject" OnValidSubmit="HandleValidSubmit">
        <div class="inputFieldSpacer">
            <p>
                Username:
                <InputText class="inputField" id="usernameRegInput" type="text" @bind-Value="_userObject.Username" />
            </p>
        </div>
        <div class="inputFieldSpacer">
            <p>
                Email:
                <InputText class="inputField" id="emailRegInput" type="email" @bind-Value="_userObject.Email" />
            </p>
        </div>
        <div class="inputFieldSpacer">
            <p>
                Password:
                <InputText class="inputField" id="passwordRegInput" type="password" @bind-Value="_userObject.Password" />
            </p>
        </div>
        <button class="btn btn-primary" id="regUserButton" type="submit">Submit</button>
    </EditForm>*@
